webpackJsonp([1],{AUI1:function(e,t){},D8LU:function(e,t){},DTqE:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("xd7I"),a={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var i=n("C7Lr")({name:"App"},a,!1,function(e){n("AUI1")},null,null).exports,s=n("e1F6"),o=n("Muz9"),c=n.n(o),l={data:function(){return{qrUrl:"/api/qr",qrStage:0,qrRequestMsg:"请求错误",qrTimestamp:0,timerQR:null}},methods:{login:function(){var e=this;c.a.get("/api/login").then(function(t){console.debug(t),e.checkQRTimer()}).catch(function(t){e.qrError(t.message)})},retry:function(){this.qrStage=0,this.login()},qrError:function(e){this.qrRequestMsg=e,this.qrStage=1,this.checkQRTimerClose(),console.log("获取QR错误："+e)},checkQR:function(){var e=this;c.a.get("/api/qr/check").then(function(t){console.debug(t),e.qrTimestamp<t.data.data.qr_time&&(e.qrTimestamp=t.data.data.qr_time,e.qrUrl="/api/qr?t="+e.qrTimestamp,console.debug("更新QR"));var n=t.data.code;if(200===n)e.qrStage=2;else if(201===n)console.log("还没拿到QR继续等待");else if(202==n){var r=t.data.data.wechat_error_code;201===r?(console.log("二维码被扫"),e.qrStage=4):400===r?(console.log("二维码确认超时"),e.qrStage=5):200===r?(e.qrStage=6,console.log("登陆成功"),e.checkQRTimerClose()):408===r?(console.log("二维码疑似失效"),e.qrStage=2):e.qrError(t.data.msg+" 状态码："+t.data.data.wechat_error_code)}else e.qrError(t.data.msg)}).catch(function(t){e.qrError(t.message)})},checkQRTimer:function(){this.checkQRTimerClose(),this.timerQR=setInterval(this.checkQR,1e3)},checkQRTimerClose:function(){this.timerQR&&clearInterval(this.timerQR),this.timerQR=null}},created:function(){this.login()},beforeDestroy:function(){this.checkQRTimerClose()}},g={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"qr-root"},[0===e.qrStage?n("div",{directives:[{name:"loading",rawName:"v-loading",value:0===e.qrStage,expression:"qrStage === 0"}],staticClass:"qr-loading",attrs:{"element-loading-text":"正在请求微信登录二维码","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}}):1===e.qrStage?n("div",{staticClass:"qr-error"},[n("p",{staticClass:"text"},[e._v(e._s(e.qrRequestMsg))]),e._v(" "),n("ElButton",{attrs:{type:"primary"},on:{click:e.retry}},[e._v("重试")])],1):n("div",{staticClass:"qr"},[n("ElRow",{attrs:{type:"flex",justify:"center"}},[n("ElCol",{attrs:{span:5}},[n("ElCard",{attrs:{"body-style":{padding:"0px"}}},[n("img",{staticClass:"image",attrs:{src:e.qrUrl}})]),e._v(" "),2===e.qrStage?n("div",[n("p",[e._v("请扫描二维码登录")])]):3===e.qrStage?n("div",[n("p",[e._v("二维码疑似失效")]),e._v(" "),n("ElButton",{attrs:{type:"primary"},on:{click:e.retry}},[e._v("刷新")])],1):4===e.qrStage?n("div",[n("p",[e._v("请在APP上点击登陆")])]):5===e.qrStage?n("div",[n("p",[e._v("登陆超时")]),e._v(" "),n("ElButton",{attrs:{type:"primary"},on:{click:e.retry}},[e._v("刷新")])],1):6===e.qrStage?n("div",[n("p",[e._v("登陆成功")])]):e._e()],1)],1)],1)])},staticRenderFns:[]};var u=n("C7Lr")(l,g,!1,function(e){n("TdJA")},"data-v-b67f2c3e",null).exports;function m(e){return null==e||void 0===e||""==e.trim()}String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};var d={data:function(){return{username:"",message:""}},methods:{send:function(){var e=this;if(m(this.username)||m(this.message))this.$message({message:"用户名和消息不得为空",type:"warning"});else{var t={username:this.username,message:this.message};c.a.post("/api/send",t).then(function(t){200===t.data.code?(e.$message({message:"发送成功",type:"success"}),e.message=""):e.$message({message:t.data.msg,type:"error"})}).catch(function(t){e.$message({message:t.message,type:"error"})})}}}},p={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ElRow",{attrs:{type:"flex",justify:"center"}},[n("ElCol",{attrs:{span:12}},[n("div",{staticStyle:{margin:"20px 0"}}),e._v(" "),n("ElInput",{attrs:{placeholder:"用户名，可以是备注名",type:"text"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),n("div",{staticStyle:{margin:"20px 0"}}),e._v(" "),n("ElInput",{attrs:{placeholder:"信息",type:"textarea",autosize:{minRows:3}},model:{value:e.message,callback:function(t){e.message=t},expression:"message"}}),e._v(" "),n("div",{staticStyle:{margin:"20px 0"}}),e._v(" "),n("ElButton",{attrs:{type:"primary"},on:{click:e.send}},[e._v("发送")])],1)],1)},staticRenderFns:[]};var h=0,v=1,f=2,_=3,q={components:{QR:u,SendMessage:n("C7Lr")(d,p,!1,function(e){n("yq1t")},"data-v-90b55d9a",null).exports},data:function(){return{loginState:h,msg:"",timerLogin:null,showQR:!1}},created:function(){this.checkLoginTimer()},methods:{login:function(){this.showQR=!0},loginCheck:function(){var e=this;c.a.get("/api/login/check").then(function(t){var n=t.data.data.login?f:_;e.loginState!=_&&n===_&&(e.showQR=!1),e.loginState=n,console.debug("CheckLogin oldState = "+e.loginState+" newState = "+n)}).catch(function(t){e.msg=t.message,e.loginState=v,e.checkLoginTimerClose(),console.error(t)})},logout:function(){c.a.post("/api/logout").then(function(e){console.log(e)}).catch(function(e){console.error(e)})},retryLoginCheck:function(){this.checkLoginTimer()},checkLoginTimer:function(){this.loginState=h,this.checkLoginTimerClose(),this.timerLogin=setInterval(this.loginCheck,1e3)},checkLoginTimerClose:function(){this.timerLogin&&clearInterval(this.timerLogin),this.timerLogin=null}},beforeDestroy:function(){this.checkLoginTimerClose()}},y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"login"},[0===e.loginState?n("div",[n("p",[e._v("正在获取登录状态")])]):1===e.loginState?n("div",[n("p",[e._v("获取登录状态错误")]),e._v(" "),n("p",[e._v(e._s(e.msg))]),e._v(" "),n("ElButton",{attrs:{type:"primary"},on:{click:e.retryLoginCheck}},[e._v("重试")])],1):2===e.loginState?n("div",[n("p",[e._v("已经登录")]),e._v(" "),n("ElButton",{attrs:{type:"primary"},on:{click:e.logout}},[e._v("退出登录")]),e._v(" "),n("SendMessage")],1):3===e.loginState?n("div",[n("ElButton",{directives:[{name:"show",rawName:"v-show",value:!e.showQR,expression:"!showQR"}],attrs:{type:"primary"},on:{click:e.login}},[e._v("登录")]),e._v(" "),e.showQR?n("QR"):e._e()],1):e._e()])},staticRenderFns:[]};var R=n("C7Lr")(q,y,!1,function(e){n("DTqE")},"data-v-50320c4c",null).exports;r.default.use(s.a);var S=new s.a({routes:[{path:"/",name:"Home",redirect:"/login"},{path:"/login",name:"Login",component:R}]}),k=n("jsbU"),C=n.n(k);n("D8LU");r.default.prototype.$axios=c.a,r.default.config.productionTip=!1,r.default.use(C.a),new r.default({el:"#app",router:S,components:{App:i},template:"<App/>"})},TdJA:function(e,t){},yq1t:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.c36f1de81b4f46917dc8.js.map